---
title: второй
---
# Билет
Работа с HTTP в Java - веб-сервер, сервер приложений, контейнер сервлетов, сервлеты (логика работы, жизненный цикл сервлета, методы HttpServlet), фильтры, слушатели (ServletContextListener и др.), структура war-архива приложения на сервлетах, конфигурация веб-приложения (web.xml и аннотации), сессии, контекст, внутреннее перенаправление

# Веб-сервер
Сервер, принимающий HTTP-запросы от клиентов и выдающий им HTTP-ответы, вместе с HTML-страницей, изображением, файлом, медиа-потоком или другими данными

# Сервер приложений и контейнер сервлетов
В общем, есть JavaEE  - это расширение JavaSE, которое предоставляет разработчикам инструменты для создания приложений на основе серверных компонентов

**Сервер приложений** - это полная реализация JavaEE. То есть сюда входит все: БД, распределенные транзакции и тд

**Контейнер сервлетов** - это минимальная часть JavaEE - ServletAPI и JSP. Остальное добавляется при необходимости сторонними библиотеками
# Сервлеты
## Определение
**Сервлеты Java** — это классы, которые реализуют интерфейс `javax.servlet.Servlet`, которые умеют принимать запросы от клиента и возвращать ему ответы
```java
public interface Servlet {
	void init(ServletConfig var1) throws ServletException;
	void service(ServletRequest var1, ServletResponse var2) throws ServletException;
	void destroy(); 
}
```

## Методы
- `init()` - вызывается при загрузке сервлета в контейнер сервлетов
- `service(request, response)` - вызывается при необходимости выполнить именно данный сервлет для обработки запроса
	- данные запроса берем из request
	- результат пишем в response
- `destroy()` - вызывается при удалении сервлета из контейнера сервлетов

## Жизненный цикл
- До начала обслуживания запросов(если сервлет еще ни разу не загружался):
	- Tomcat загружает класс сервлета
	- Tomcat создает экземпляр класса сервлета
	- Tomcat вызывает метод init() сервлета
- Обслуживание запросов:
	- Tomcat получает запрос, определяет, какой сервлет использовать и вызывает у него service()
	- Каждый запрос обслуживается в отдельном потоке.
- Изъятие сервлета из эксплуатации
	- Tomcat вызывает метод destroy()


# HttpServlet
## Методы
- doGet()
- doPost() 
- doPut() 
- doDelete() 
- doOptions() 
- doHead() 
## Пример
```java
@WebServlet(“/main”)
public class TestServlet extends HttpServlet {
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { 
		PrintWriter out = resp.getWriter();
		out.println(“Hello world”); 
	}
	
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		String login = req.getParameter(“login”); 
		resp.getWriter().println(“Data is processed”); 
	}
}
```

# Фильтры
## Определение
Фильтры перехватывают запрос и обрабатывает его перед тем, как он попадет к сервлету, а также могут влиять и на ответ. Используется для фильтрации вводимых данных, сжатия данных, пользовательской аутентификации.

В Java фильтры реализуются через интерфейс `Filter`. У этого интерфейса есть три метода
- `init()`
- `doFilter()`
- `destroy()`
## Пример
```java
public class EncodingFilter implements Filter {
    public void init() {
    }
 
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        request.setCharacterEncoding("UTF-8");
        response.setCharacterEncoding("UTF-8");
        chain.doFilter(request, response);
    }
    
    public void destroy() {
    }
}
```

`chain` - это цепочка фильтров, то есть после обработки этого фильтра работа перейдет к следующему фильтру (если он имеется), либо перейдет к сервлету
# Контекст
Контекст - по-простому, подсайт. Выделенные сервером приложений ресурсы для веб-приложения. Сайт разворачивается в определенном контексте

`http://localhost:8080/test` - контекст с именем `test`

В Java **ServletContext** - это объект, который представляет контекст веб-приложения и дает доступ к конфигурации приложения, ресурсам и другим сервлетам в контексте. Он является общим для всех сервлетов в приложении.
# Слушатели
## Определение
ServletContextListener - это интерфейс в Java, который позволяет приложению реагировать на события, связанные с контекстом сервлета

Когда контекст сервлета инициализируется или уничтожается, соответствующие методы интерфейса ServletContextListener вызываются автоматически. Это позволяет приложению выполнять определенные действия при запуске или остановке контекста сервлета, например, инициализировать базу данных или освободить ресурсы

## Пример
Инициализация базы данных
```java
import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;

public class DatabaseInitializer implements ServletContextListener {

    @Override
    public void contextInitialized(ServletContextEvent sce) {
        // код для инициализации подключения к базе данных
    }

    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        // код для закрытия подключения к базе данных
    }
}
```

# Mapping
Mapping в сервлетах Java определяет, какой URL-адрес должен быть связан с определенным сервлетом. Это позволяет веб-серверу понимать, какой сервлет должен обрабатывать запрос, который приходит от клиента

## web.xml
Файл web.xml хранит информацию о конфигурации приложения. Данный файл должен располагаться в папке WEB-INF приложения. При запуске Tomcat считывает его содержимое и использует считанную конфигурацию.

### Пример
```xml
<servlet>
    <servlet-name>MyServlet</servlet-name>
    <servlet-class>com.example.MyServlet</servlet-class>
</servlet>

<servlet-mapping>
    <servlet-name>MyServlet</servlet-name>
    <url-pattern>/my-servlet</url-pattern>
</servlet-mapping>
```

Здесь мы определяем сервлет с именем MyServlet и классом com.example.MyServlet. Затем мы определяем, что этот сервлет должен обрабатывать запросы, которые поступают на URL-адрес /my-servlet.

### Паттерны
`<url-pattern>/*<url-pattern>` - все запросы будут вести к сервлету
`<url-pattern>/<url-pattern>` - переопределяет сервлет по умолчанию
`<url-pattern><url-pattern>` - запрос к корню приложения 

## Аннотации
Всего существует три вида аннотаций:
- @WebServlet
- @WebFilter
- @WebListener

Чтобы сделать mapping можно использовать аннотации, для этого необходимо добавить аннотацию к классу
```java
@WebServlet(urlPatterns = "/my-servlet")
public class MyServlet extends HttpServlet {}
```

# Сессия
Механизм хранения данных пользователя на сервере

Для создания сессии в Java Servlet необходимо вызвать метод getSession() из объекта HttpServletRequest. Если сессия уже существует, то этот метод вернет существующий объект HttpSession. Если сессия не существует, то будет создан новый объект HttpSession

```java
HttpSession session = request.getSession();
session.setAttribute("username", "John");
```

# Перенаправления
## Внешний
Перенаправляет запрос на другой URL
```java
response.sendRedirect("http://example.com");
```
## Внутренний
Перенаправляет запрос на другой сервлет
```java
RequestDispatcher dispatcher = request.getRequestDispatcher("/newServlet");
dispatcher.forward(request, response);
```

# Все что связано с "ция"
## Регистрация
Процесс первоначальной записи данных о пользователе
## Аутентификация
Процесс подтверждения пользователя того, что он тот, за кого себя выдает
## Авторизация
Процесс выдачи прав на определенные действия
## Идентификация
Получение общей информации по ее частичке

# Структура war-архива приложения
WAR (Web Application Archive) - это файловый формат, который используется для упаковки и развертывания веб-приложений на сервере приложений. WAR-архив содержит все необходимые файлы и директории для запуска веб-приложения.

Структура WAR-архива выглядит следующим образом:
- `WEB-INF/`
	- `web.xml`
	- `classes/`
		- `*.class`
	- `lib/`
		- `*.jar`
- `META-INF/`
	- `MANIFEST.MF`


1. Директория WEB-INF содержит все файлы и ресурсы, связанные с веб-приложением:
   - Файл web.xml содержит конфигурационную информацию о приложении, такую как параметры контекста, настройки сервлетов и фильтров, а также многие другие параметры.
   - Директория classes/ содержит скомпилированные классы Java, которые используются в приложении.
   - Директория lib/ содержит все необходимые библиотеки и зависимости, которые используются в приложении.
2. Директория META-INF/ содержит метаданные приложения:
   - Файл MANIFEST.MF содержит информацию о версии приложения, авторе, дате создания и другую информацию.
![](https://lh7-us.googleusercontent.com/wUK2KGEzIzUPKLfRG6QhxPAJsQ6gcdM2llU9mDiNGlFQzw9jlfnN5Bpi8_iwKr75FBvg_SdWLAFQID9G-Y6cYw8CRpMVRUUv7HsIidMeAWOUCoJPpB-bkBsYzhq0zFfldBNn41w8VfxkEHuKQ3HmXSY)