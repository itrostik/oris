---
title: второй
---
# Билет
Работа с HTTP в Java - веб-сервер, сервер приложений, контейнер сервлетов, сервлеты (логика работы, жизненный цикл сервлета, методы HttpServlet), фильтры, слушатели (ServletContextListener и др.), структура war-архива приложения на сервлетах, конфигурация веб-приложения (web.xml и аннотации), сессии, контекст, внутреннее перенаправление

# Веб-сервер
Сервер, принимающий HTTP-запросы от клиентов и выдающий им HTTP-ответы, вместе с HTML-страницей, изображением, файлом, медиа-потоком или другими данными

# Сервер приложений и контейнер сервлетов
В общем, есть **JavaEE** - набор стандартов/интерфейсов для работы с вебом

**Сервер приложений** - это полная реализация JavaEE. То есть сюда входит все: БД, распределенные транзакции и тд

**Контейнер сервлетов** - это минимальная часть JavaEE - ServletAPI и JSP. Остальное добавляется при необходимости сторонними библиотеками
# Сервлеты
## Определение
**Сервлеты Java** — это классы, которые реализуют интерфейс javax.servlet.Servlet, умеют принимать запросы от клиента и возвращать ему ответы. С помощью сервлетов строится клиент-серверная архитектура

```java
package javax.servlet;

public interface Servlet {
	void init(ServletConfig var1) throws ServletException;
	void service(ServletRequest var1, ServletResponse var2) throws ServletException;
	void destroy();
}
```

## Методы
- init(...) - вызывается при загрузке сервлета в контейнер сервлетов(Tomcat)
- service(request, response) - вызывается при необходимости выполнить именно данный сервлет для обработки запроса
	- данные запроса берем из request
	- результат пишем в response
- destroy() - вызывается при удалении сервлета из контейнера сервлетов(Tomcat)

## Жизненный цикл
- До начала обслуживания запросов(если сервлет еще ни разу не загружался):
	- Tomcat загружает класс сервлета
	- Tomcat создает экземпляр класса сервлета
	- Tomcat вызывает метод init() сервлета
- Обслуживание запросов:
	- Tomcat получает запрос, определяет, какой сервлет использовать и вызывает у него service(...).
	- Каждый запрос обслуживается в отдельном потоке.
- Изъятие сервлета из эксплуатации
	- Tomcat вызывает метод destroy().


# HttpServlet
## Методы
- doGet (HttpServletRequest req, HttpServletResponse resp)
- doPost (HttpServletRequest req, HttpServletResponse resp) 
- doPut (HttpServletRequest req, HttpServletResponse resp) 
- doDelete (HttpServletRequest req, HttpServletResponse resp) 
- doOptions (HttpServletRequest req, HttpServletResponse resp) 
- doHead (HttpServletRequest req, HttpServletResponse resp) 
## Пример
```java
@WebServlet(“/main”)
public class TestServlet extends HttpServlet {
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { 
		PrintWriter out = resp.getWriter();
		out.println(“Hello world”); 
	}
	
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		String login = req.getParameter(“login”); 
		resp.getWriter().println(“Data is processed”); 
	}
}
```

# URL-mapping. Шаблоны
1. Ищем точное совпадение с Path 
2. Ищем наибольшее совпадение
3. Ищем совпадение по расширению 
4. Если нет совпадений, идем на сервлет по умолчанию

`*` - произвольный набор символов (до /)
`**` - произвольный набор символов (включая /)
  
`<url-pattern>/*<url-pattern>` - все запросы будут вести к сервлету
`<url-pattern>/<url-pattern>` - переопределяет сервлет по умолчанию
`<url-pattern><url-pattern>` - запрос к корню приложения 

  

# Способ сопоставления путей и сервлетов
Файл web.xml хранит информацию о конфигурации приложения.

Данный файл должен располагаться в папке WEB-INF приложения. При запуске Tomcat считывает его содержимое и использует считанную конфигурацию.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
version="3.1">

<servlet>
  <servlet-name>Hello</servlet-name>
  <servlet-class>HelloServlet</servlet-class>
</servlet>

<servlet-mapping>
  <servlet-name>Hello</servlet-name>
  <url-pattern>/hello</url-pattern>
</servlet-mapping>
</web-app>
```
  
С помощью элемента `<servlet>` определяется сервлет. Элемент `<servlet-name>` задает имя сервлета, на которое будет проецироваться класс, указанный в элементе `<servlet-class>`. Затем в элементе `<servlet-mapping>` сервлет с именем Hello сопоставляется с путем `/hello`.

# Аннотации
- @WebServlet
- @WebFilter
- @WebListener

# Фильтры
## Определение
Фильтры перехватывают запрос и обрабатывает его перед тем, как он попадет к сервлету, а также могут влиять и на ответ. 

зачем нужны? - фильтрация вводимых данных, сжатие данных, пользовательская аутентификация.

## Пример
```java
public class FilterConnect implements Filter { 
	public void doFilter (ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { 
		if (request.getParameter("username") != null) {
			chain.doFilter(request, response); 
		} 
	} 
}
```

# Контекст
Контекст - по-простому, подсайт. Выделенные сервером приложений ресурсы для веб-приложения. Сайт разворачивается в определенном контексте

`http://localhost:8080/test` - контекст с именем `test`

# Сессия
Механизм хранения данных пользователя на сервере, обычно работает с помощью Cookie.

# Перенаправления
- Внешний - через статус + хедер, работа выполняется браузером
- Внутренний - один сервлет просит другой обработать запрос, браузер об этом не знает - ссылка остается прежней.

# ция
## Регистрация
Процесс первоначальной записи данных о пользователе
## Аутентификация
Процесс подтверждения пользователя того, что он тот, за кого себя выдает
## Авторизация
Процесс выдачи прав на определенные действия
## Идентификация
Получение общей информации по ее частичке

# Структура war-архива приложения
WAR (Web Application Archive) - это файловый формат, который используется для упаковки и развертывания веб-приложений на сервере приложений. WAR-архив содержит все необходимые файлы и директории для запуска веб-приложения.

Структура WAR-архива выглядит следующим образом:
1. WEB-INF/
   - web.xml
   - classes/
      - *.class
   - lib/
      - *.jar
2. META-INF/
   - MANIFEST.MF

1. Директория WEB-INF содержит все файлы и ресурсы, связанные с веб-приложением:
   - Файл web.xml содержит конфигурационную информацию о приложении, такую как параметры контекста, настройки сервлетов и фильтров, а также многие другие параметры.
   - Директория classes/ содержит скомпилированные классы Java, которые используются в приложении.
   - Директория lib/ содержит все необходимые библиотеки и зависимости, которые используются в приложении.
2. Директория META-INF/ содержит метаданные приложения:
   - Файл MANIFEST.MF содержит информацию о версии приложения, авторе, дате создания и другую информацию.

WAR-архив можно создать с помощью сборщика проектов, таких как Maven или Gradle, или вручную с помощью архиватора, такого как WinZip или 7-Zip.
![](https://lh7-us.googleusercontent.com/wUK2KGEzIzUPKLfRG6QhxPAJsQ6gcdM2llU9mDiNGlFQzw9jlfnN5Bpi8_iwKr75FBvg_SdWLAFQID9G-Y6cYw8CRpMVRUUv7HsIidMeAWOUCoJPpB-bkBsYzhq0zFfldBNn41w8VfxkEHuKQ3HmXSY)